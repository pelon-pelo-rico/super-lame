<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Step 9</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>body{margin:0}</style>
</head>
<body>
  <!-- Renderer: physically-correct, ACES tone mapping, antialias -->
  <a-scene renderer="physicallyCorrectLights: true; colorManagement: true; toneMapping: ACESFilmicToneMapping; antialias: true">
    <a-assets>
      <!-- 360 pano used for background + reflections -->
      <img id="pano" src="360image01.jpg">
      <!-- texture for the cylinder -->
      <img id="tex1" src="texture.jpg">
    </a-assets>

    <!-- 360 background -->
    <a-sky id="sky" src="#pano"></a-sky>

    <!-- Soft “ambient” and a key light for crisp highlights -->
    <a-entity light="type: hemisphere; intensity: 1; groundColor: #666" position="0 4 0"></a-entity>
    <a-entity light="type: directional; intensity: 1.2" position="2 4 2"></a-entity>

    <!-- Camera/controls -->
    <a-entity id="rig" wasd-controls position="0 1.6 0">
      <a-entity camera look-controls></a-entity>
    </a-entity>

    <!-- Metal sphere (mirror-like) -->
    <a-sphere position="-1.8 1 -3" radius="0.5"
              material="metalness: 1; roughness: 0.05; color: #888">
    </a-sphere>

    <!-- Glass cube (transparent) -->
    <a-box position="0 1 -3" depth="1" height="1" width="1"
           material="color: #aaf; opacity: 0.25; transparent: true; metalness: 0.5; roughness: 0.05">
    </a-box>

    <!-- Shiny plastic cone -->
    <a-cone position="1.8 1 -3" height="1.2" radius-bottom="0.6"
            material="color: #ff00ff; metalness: 0.5; roughness: 0.25">
    </a-cone>

    <!-- Cylinder with image texture -->
    <a-cylinder position="0 0.75 -1.5" radius="0.4" height="1.5"
                material="src: #tex1; roughness: 0.4; metalness: 0.1">
    </a-cylinder>
  </a-scene>

  <script>
    // Use the pano as the environment map (reflections) via PMREM
    const sceneEl = document.querySelector('a-scene');
    sceneEl.addEventListener('loaded', () => {
      const renderer = sceneEl.renderer;
      if (!renderer) return;

      const pmrem = new THREE.PMREMGenerator(renderer);
      new THREE.TextureLoader().load(
        document.getElementById('pano').getAttribute('src'),
        (tex) => {
          tex.mapping = THREE.EquirectangularReflectionMapping;
          // Prefilter for PBR (smoother, realistic reflections)
          const envMap = pmrem.fromEquirectangular(tex).texture;
          sceneEl.object3D.background = tex;     // keep pano as background
          sceneEl.object3D.environment = envMap; // reflections for PBR
        }
      );
    });
  </script>
</body>
</html>
